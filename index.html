<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Luce 1</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #0c1116;
      --panel: #111827;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #22c55e;
      --danger: #ef4444;
      --border: #1f2937;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      font-family: "Inter", system-ui, -apple-system, sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at 20% 20%, rgba(34, 197, 94, 0.12), transparent 35%), radial-gradient(circle at 80% 0%, rgba(239, 68, 68, 0.14), transparent 30%), var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 1.5rem;
      color: var(--text);
      padding: 2rem 1rem;
    }

    .card {
      width: min(320px, 100%);
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 1.5rem;
      text-align: center;
    }

    h1 {
      margin: 0 0 1.5rem;
      font-size: 1.8rem;
      letter-spacing: -0.02em;
      font-weight: 700;
    }

    .actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .actions.single {
      grid-template-columns: 1fr;
    }

    button {
      appearance: none;
      border: none;
      border-radius: 12px;
      padding: 0.8rem 1rem;
      font-size: 0.95rem;
      font-weight: 700;
      color: #0b0f13;
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 120ms ease, filter 120ms ease;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.18);
      width: 100%;
    }

    button:disabled {
      cursor: not-allowed;
      opacity: 0.6;
      filter: grayscale(0.25);
    }

    .btn-on {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      box-shadow: 0 8px 24px rgba(34, 197, 94, 0.25);
    }

    .btn-blink {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25);
      color: #fff;
    }

    .btn-off {
      background: linear-gradient(135deg, #ef4444, #b91c1c);
      box-shadow: 0 8px 24px rgba(239, 68, 68, 0.23);
      color: #fff;
    }

    button:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.25);
    }

    button:not(:disabled):active {
      transform: translateY(0);
      filter: brightness(0.95);
    }

    .status {
      margin-top: 1.5rem;
      font-size: 0.85rem;
      color: var(--muted);
      min-height: 1.2em;
    }

    .status.error {
      color: var(--danger);
    }

    .status.success {
      color: var(--accent);
    }

    #login-overlay {
      position: fixed;
      inset: 0;
      background: var(--bg);
      z-index: 1000;
      display: grid;
      place-items: center;
    }

    input {
      background: #0c121c;
      border: 1px solid var(--border);
      color: var(--text);
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 1rem;
      width: 100%;
      box-sizing: border-box;
      font-size: 1rem;
      outline: none;
    }

    input:focus {
      border-color: var(--accent);
    }

    #lights-row {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 1.5rem;
      justify-content: center;
      width: 100%;
      max-width: 1000px;
    }
  </style>
</head>

<body>
  <div id="login-overlay">
    <div class="card">
      <h1>Login</h1>
      <input type="text" id="username" placeholder="Username" />
      <input type="password" id="password" placeholder="Password" />
      <button class="btn-on" id="btn-login">Entra</button>
      <div id="login-error" class="status error"></div>
    </div>
  </div>

  <div id="app-content"
    style="display: none; width: 100%; display: flex; flex-direction: column; align-items: center; gap: 1.5rem;">

    <div id="lights-row">
      <main class="card">
        <h1>Luce 1</h1>
        <div class="actions">
          <button class="btn-on" id="btn-on">ðŸŸ¢ ON</button>
          <button class="btn-off" id="btn-off">ðŸ”´ OFF</button>
        </div>
      </main>

      <section class="card">
        <h1>Luce 2</h1>
        <div class="actions">
          <button class="btn-on" id="btn-on-2">ðŸŸ¢ ON</button>
          <button class="btn-off" id="btn-off-2">ðŸ”´ OFF</button>
        </div>
      </section>

      <section class="card">
        <h1>Luce 3</h1>
        <div class="actions">
          <button class="btn-on" id="btn-on-3">ðŸŸ¢ ON</button>
          <button class="btn-off" id="btn-off-3">ðŸ”´ OFF</button>
        </div>
      </section>
    </div>

    <section class="card">
      <h1>Test D&I</h1>

      <div style="margin-bottom: 1rem;">
        <select id="blink-selector" style="
            width: 100%;
            padding: 0.8rem;
            border-radius: 12px;
            background: #0c121c;
            border: 1px solid var(--border);
            color: var(--text);
            font-size: 1rem;
            outline: none;
        ">
          <option value="email">Email</option>
          <option value="high">HighImportance</option>
          <option value="msg">NewMessageInChannel</option>
          <option value="meeting">Meeting</option>
        </select>
      </div>

      <div class="actions single">
        <button class="btn-blink" id="btn-blink">ðŸš¨ Blink</button>
      </div>
    </section>

    <div class="status" id="status"></div>
  </div>

  <script>
    const CONFIG = {
      endpointOn: "https://raspberrypi.taild4c19b.ts.net/accendi_luce",
      endpointOff: "https://raspberrypi.taild4c19b.ts.net/spegni_luce",
      endpointOn2: "https://raspberrypi.taild4c19b.ts.net/accendi_luce2",
      endpointOff2: "https://raspberrypi.taild4c19b.ts.net/spegni_luce2",
      endpointOn3: "https://raspberrypi.taild4c19b.ts.net/accendi_luce3",
      endpointOff3: "https://raspberrypi.taild4c19b.ts.net/spegni_luce3",
      endpointEmail: "https://raspberrypi.taild4c19b.ts.net/email",
      endpointHigh: "https://raspberrypi.taild4c19b.ts.net/HighImportance",
      endpointMsg: "https://raspberrypi.taild4c19b.ts.net/NewMessageInChannel",
      endpointMeeting: "https://raspberrypi.taild4c19b.ts.net/meeting",
      token: "Bearer dario-raspi-led-2025-super-token-9fA3k!"
    };

    const statusBox = document.getElementById("status");
    const btnOn = document.getElementById("btn-on");
    const btnOff = document.getElementById("btn-off");
    const btnOn2 = document.getElementById("btn-on-2");
    const btnOff2 = document.getElementById("btn-off-2");
    const btnOn3 = document.getElementById("btn-on-3");
    const btnOff3 = document.getElementById("btn-off-3");
    const btnBlink = document.getElementById("btn-blink");
    const blinkSelector = document.getElementById("blink-selector");

    function setLoading(isLoading) {
      btnOn.disabled = isLoading;
      btnOff.disabled = isLoading;
      btnOn2.disabled = isLoading;
      btnOff2.disabled = isLoading;
      btnOn3.disabled = isLoading;
      btnOff3.disabled = isLoading;
      btnBlink.disabled = isLoading;
      blinkSelector.disabled = isLoading;
    }

    function showStatus(message, type = "neutral") {
      statusBox.textContent = message;
      statusBox.className = "status " + type;

      if (type !== "neutral") {
        setTimeout(() => {
          statusBox.textContent = "";
          statusBox.className = "status";
        }, 3000);
      }
    }

    async function sendCommand(action) {
      let url;
      if (action === "on") url = CONFIG.endpointOn;
      else if (action === "off") url = CONFIG.endpointOff;
      else if (action === "on2") url = CONFIG.endpointOn2;
      else if (action === "off2") url = CONFIG.endpointOff2;
      else if (action === "on3") url = CONFIG.endpointOn3;
      else if (action === "off3") url = CONFIG.endpointOff3;
      else if (action === "email") url = CONFIG.endpointEmail;
      else if (action === "high") url = CONFIG.endpointHigh;
      else if (action === "msg") url = CONFIG.endpointMsg;
      else if (action === "meeting") url = CONFIG.endpointMeeting;

      setLoading(true);
      showStatus("Invio...", "neutral");

      try {
        const response = await fetch(url, {
          method: "POST",
          headers: {
            "Authorization": CONFIG.token,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({})
        });

        if (!response.ok) {
          const text = await response.text();
          throw new Error(`Errore ${response.status}: ${text}`);
        }

        showStatus("Fatto!", "success");
      } catch (error) {
        console.error(error);
        showStatus("Errore di connessione", "error");
      } finally {
        setLoading(false);
      }
    }

    btnOn.addEventListener("click", () => sendCommand("on"));
    btnOff.addEventListener("click", () => sendCommand("off"));
    btnOn2.addEventListener("click", () => sendCommand("on2"));
    btnOff2.addEventListener("click", () => sendCommand("off2"));
    btnOn3.addEventListener("click", () => sendCommand("on3"));
    btnOff3.addEventListener("click", () => sendCommand("off3"));
    btnBlink.addEventListener("click", () => {
      const selection = blinkSelector.value;
      sendCommand(selection);
    });

    // Login Logic
    const loginOverlay = document.getElementById("login-overlay");
    const appContent = document.getElementById("app-content");
    const btnLogin = document.getElementById("btn-login");
    const userInput = document.getElementById("username");
    const passInput = document.getElementById("password");
    const loginError = document.getElementById("login-error");

    function checkLogin() {
      const u = userInput.value;
      const p = passInput.value;

      if (u === "admin" && p === "luci2025") {
        loginOverlay.style.display = "none";
        appContent.style.display = "flex";
      } else {
        loginError.textContent = "Credenziali errate";
        setTimeout(() => loginError.textContent = "", 2000);
      }
    }

    btnLogin.addEventListener("click", checkLogin);
    passInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") checkLogin();
    });
  </script>
</body>

</html>